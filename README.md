# genicam-rs

Pure Rust building blocks for **GenICam** with an **Ethernet-first (GigE Vision)** focus.  
Cargo workspace, modular crates (GenCP, GVCP/GVSP, GenApi core), and small examples.

## Current status (Nov 2025)
  * ✅ Discovery (GVCP) on selected NICs; enumerate devices.
  * ✅ Control path (GenCP over GVCP): read/write device memory; fetch GenICam XML.
  * ✅ GenApi (Tier-1): basic NodeMap (Integer/Float/Enum/Bool/Command), ranges, access modes.
  * ✅ SwissKnife expression nodes and selector-aware NodeMap support for common patterns (subset of Tier-2 GenApi).
  * ✅ Selector-based address switching for common features (e.g., `GainSelector`).
  * Streaming (GVSP): packet reassembly, resend, MTU/packet size & delay, backpressure, stats.
  * Events & actions: message channel events; action commands (synchronization).
  * Time mapping & chunks: device↔host timestamp mapping; chunk data parsing.
  * USB3 Vision transport (planned).
  * Advanced GenApi nodes (Converter, more complex expressions, wider SFNC coverage — planned).
  * GenTL producer (.cti) and PFNC/SFNC helper utilities (planned).

## Workspace layout

crates/
  genicp/        # GenCP encode/decode
  tl-gige/       # GigE Vision (GVCP/GVSP)
  genapi-xml/    # GenICam XML loader & schema-lite parser
  genapi-core/   # NodeMap & evaluation
  genicam/       # Public API facade
crates/genicam/examples/  # Small demos (see below)

## Prereqs

  * Rust 1.75+ (pinned in `rust-toolchain.toml`)
  * Windows / Linux / macOS (tested on recent 64-bit versions; see docs for OS-specific notes)
  * Network:
    * Allow UDP broadcast on your capture NIC for discovery
    * Optional: enable jumbo frames if you plan to test high throughput

## Build & test

```bash
# Build everything
cargo build --workspace

# Run all tests
cargo test --workspace

# Generate docs locally
cargo doc --workspace --no-deps
```

## Run examples

Examples live under the `genicam` crate. Run them via the facade crate target:

- **Discover devices (GVCP broadcast):**

  ```bash
  cargo run -p genicam --example list_cameras
  ```

- **Fetch XML & print minimal metadata (control path):**

  ```bash
  cargo run -p genicam --example get_set_feature
  ```

- **Grab frames (GVSP):**

  ```bash
  cargo run -p genicam --example grab_gige
  ```

- **Events:**

  ```bash
  cargo run -p genicam --example events_gige
  ```

- **Action command (broadcast):**

  ```bash
  cargo run -p genicam --example action_trigger
  ```

- **Timestamp mapping:**

  ```bash
  cargo run -p genicam --example time_sync
  ```

- **Selectors demo:**

  ```bash
cargo run -p genicam --example selectors_demo
```

## gencamctl CLI

The workspace now provides a `gencamctl` binary offering common camera control
operations from the command line. Enable more verbose logging with `-v` or
`RUST_LOG`, prefer JSON output with `--json`, and use `--iface <IPv4>` to select
the capture interface.

Examples:

```bash
# Discover GigE Vision cameras on the network
cargo run -p gencamctl -- list

# Inspect and configure GenApi features
cargo run -p gencamctl -- get --ip 192.168.0.10 --name ExposureTime
cargo run -p gencamctl -- set --ip 192.168.0.10 --name ExposureTime --value 5000

# Receive a GVSP stream, auto-negotiate packet size, and save the first two frames
cargo run -p gencamctl -- stream --ip 192.168.0.10 --iface 192.168.0.5 --auto --save 2

# Configure and read GVCP events
cargo run -p gencamctl -- events --iface 192.168.0.5 --enable FrameStart,ExposureEnd --count 5

# Toggle chunk data features
cargo run -p gencamctl -- chunks --ip 192.168.0.10 --enable true --selectors Timestamp,ExposureTime

# Run a sustained streaming benchmark with a JSON report
cargo run -p gencamctl -- bench --ip 192.168.0.10 --duration-s 60 --json-out bench.json
```

## Troubleshooting

- No devices found: check NIC/interface selection and host firewall (UDP broadcast).
- Drops at high FPS: try jumbo frames, raise `SO_RCVBUF`, and enable packet delay.
- Windows: run as admin, allow UDP in firewall rules; jumbo frames must be enabled per NIC.

## License

MIT — see LICENSE.

## Acknowledgements

Standards: GenICam/GenApi (EMVA/A3), GigE Vision. Thanks to the open-source ecosystem for prior art and inspiration.
